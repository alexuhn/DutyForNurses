# 11/03 DFN 진행상황 (알고리즘)

## 1. 작업 완료

개요: 스케쥴 제작을 원하는 팀 정보, 간호사들의 지난 달 근무 정보, 신상 정보 등을 받아서 병동 전체 스케쥴을 제작할 수 있게 되었다. `i3 7100` 으로도  약 `7ms`만에 스케쥴을 생성할 수 있다. 



![image-20211103212012055](C:\Users\ffing\AppData\Roaming\Typora\typora-user-images\image-20211103212012055.png)



### 1) divide_nurse_info_by_team

DB에서 가져온 간호사 정보를 파싱해 스케쥴 계산을 위해 필요한 정보로 가공한다. 

**전체 코드:**

```python
def divide_nurse_info_by_team(
    team_list,
    nurse_profile_dict,
    nurse_last_months_schedule_dict
    ):
    # 1. 선언
    # 출력을 위한 dict 선언.
    divided_nurse_info_dict_by_team = dict()
    nurse_pk_by_team = dict()
    for team_number in team_list:
        divided_nurse_info_dict_by_team[team_number] = dict()
        nurse_pk_by_team[team_number] = list()
    
    # 2. 연산
    for nurse_detail in nurse_profile_dict.values():

        # 1) 앞부분에 필요한 값들.
        nurse_pk = nurse_detail[0]
        nurse_grade = nurse_detail[1]
        nurse_team = nurse_detail[2]
        nurse_offs = nurse_detail[3]
        
        # 2) 뒷부분에 필요한 값들. 
        nurse_last_month_schedule = nurse_last_months_schedule_dict[nurse_pk]
        nurse_last_shift = nurse_last_month_schedule[-1]
        nurse_shift_streaks = 0
        if not nurse_last_shift and not nurse_last_month_schedule[-2]:
            nurse_off_streaks = 2
        elif not nurse_last_shift:
            nurse_off_streaks = 1
        else:
            nurse_off_streaks = 0
            for i in range(1, 6):
                if nurse_last_month_schedule[-i]:
                    nurse_shift_streaks += 1
                else:
                    break
        
        # 3) 딕셔너리에 삽입
        nurse_pk_by_team[nurse_team].append(nurse_pk)

        divided_nurse_info_dict_by_team[nurse_team][nurse_pk] = [
            nurse_pk,
            nurse_grade,
            nurse_team,
            0,
            nurse_shift_streaks,
            nurse_offs,
            0,
            0,
            nurse_off_streaks,
            nurse_last_shift
        ]
    # pprint(nurse_pk_by_team)
    return divided_nurse_info_dict_by_team, nurse_pk_by_team
```



**입력 정보 예시:**

![image-20211103211239151](C:\Users\ffing\AppData\Roaming\Typora\typora-user-images\image-20211103211239151.png)



### 2) 함수의 전반적 수정.

팀 전체 시간표 작성에 대응하기 위해 전체적인 매개변수 관계가 틀어졌다. 일괄적으로 변경 완료.



## 2. 작업 예정. 

### 1) 각종 정보들의 클래스화.

추가 기능 제작에 앞서 반복되는 부분을 클래스화 한다. 

이 부분을 `NursePriorityInfo` 같은 이름의 class로 변경할 예정이다.

코드를 최소 100줄 가량 줄일 수 있을 것이다. 

![image-20211103211657713](C:\Users\ffing\AppData\Roaming\Typora\typora-user-images\image-20211103211657713.png)

### 2) 우선순위 제작 로직 수정

'각종 일을 하지 못할 사유' 등이 있으면, 그들의 근무 우선순위를 후순위로 미룬다.

조건 없는 OFF의 우선순위는 2000 쯤으로 미룬다. 